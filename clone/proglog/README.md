# HTTP JSON 서비스 적용
JSON API는 웹에서 가장 일반적으로 사용하는 API이다. 대부분의 언어가 JSON을 기본적으로 지원하므로 만들기 쉽기 때문이다.
또한 JSON은 사람이 읽기 쉽고, HTTP API는 터미널에서 curl로 호출하거나 브라우저로 열기만 하면 된다.

JSON/HTTP는 작은 웹서비스에만 적합한 것이 아니다. 유명한 오픈소스인 elasticsearch나 etcd 같은 프로젝트도 고객이 사용하는 API로 JSON/HTTP를 사용하며, 내부 노드 간 통신에는
성능 향상을 위해 그달만의 바이너리 프로토콜을 사용한다.

고는 표준 라이브러리만으로 JSON/HTTP를 구현을 쉽게 할 수 있다. 고의 선언 태그와 표준 라이브러리의 encoding/json 패키지를 사용하면 직렬화가 간편하다.

## 커밋 로그 만들기
처음 프로토타입으로 커밋 로그를 만들 땐, 커밋 로그가 추가만 할 수 있는 데이터 구조체이다. 연속한 레코드로 이루어지고 시간순으로 정렬된다.
이처럼 간단한 커밋 로그는 슬라이스로 만든다.

## 프로토콜 버퍼와 구조체
서비스들은 네트워크로 통신한다. 구조체와 같은 데이터를 네트워크로 보내려면 데이터를 전송할 수 있는 형태로 인코딩해야한다. 대표적 형태가 JSON이다.
pulic API나 클라이언트를 통제할 수 없는 프로젝트를 만든다면 JSON을 선택한다.

하지만 private API 또는 클라이언트를 통제할 수 있는 상황이라면 JSON보다 더 나은 데이터 구조화와 전송방식을 선택할 수 있다.
그게 바로 프로토콜 버퍼 (protobuf)는 언어와 플랫폼에 상관없이 쓸 수 있고 확장할 수 있는, 데이터를 구조화하고 직렬화하는 메커니즘이다.
### 장점
- 자료형 안정성 보장
- 스키마 위반 방지
- 빠른 직렬화
- 하위 호환성 제공

1. 일관된 스키마
> protobuf로 의미하는 semantics를 인코딩하고 서비스 전반에 걸쳐 사용하면 전체 시스템 일관성을 보장할 수 있다.
> 고 언어의 자료형 검사를 통해 구조체 의존성을 업데이트하고 변경한 데이터 모델을 테스트할 수 있다.
> 이렇게 컴파일과 테스트를 마치면 스키마의 일관성에 문제가 없는지 확인할 수 있다.
2. 버전 관리 제거
> 구글이 protobuf를 만든 이유 중 하나는 버전을 확인할 필요성을 없애고 지저분한 코드를 피하려고 했다.
> protobuf는 필드마다 번호를 매기는데, 새로운 기능을 내놓거나 변경할 때 하위 호환성을 관리하려는 것이다.
> 덕분에 새로운 필드를 추가하기 쉽고, 파싱하고 전달만 하는 중간 서버는 모든 필드를 알 필요가 없다.
> 필드를 제거할 때는 더 이상 사용하지 않는 필드에 'reserved'라고 표시만 하면, 컴파일할 때, 해당 필드를 사용하려는 코드가 있는지 체크해준다.
>
>

3. 줄어드는 보일러플레이트 코드
> 컴파일로 생성한 protobuf 라이브러리에 인코딩과 디코딩 메서드가 만들어진다. 직접 코드를 짤 필요가 없다.

4. 확장성
> protobuf 컴파일러는 자신만의 컴파일 로직으로 컴파일할 수 있다. 예를 들어, 여러 구조체가 공통의 메서드를 가지게 하려면, protobuf에서 자동으로 해당 메서드를 생성하는 플러그인을 만들 수 있다.

5. 언어 불가지론
> 여러 언어가 가능하다. protobuf 버전 3.0 이후(C++, Go, Java, Python, Ruby, C#, Object-C, PHP)를 지원한다.

6. 성능
> 고성능이며 페이로드가 적고, 직렬화할 때 JSON보다 6배 빠르다. gRPC는 API 정의 및 메시지 직렬화에 프로토콜 버퍼를 사용한다.


# 네트워크를 통한 서비스 구축
네트워크를 통해서 여러 사람이 사용할 수 있는 서비스를 구축해볼 것이다. 네트워크로 서비스하면 세가지 이점을 제공한다.
- 가용성과 확장성을 위해 여러 컴퓨터에 걸쳐 실행할 수 있다.
- 여러 사람이 같은 데이터로 소통할 수 있다.
- 사람들이 쉽게 접근하고 사용할 수 있는 인터페이스를 제공한다.

현재 분산 서비스에 대한 요청을 처리하는 최고의 도구는 구글의 gRPC이다.

# gRPC란,

## gRPC 서비스 정의
> gRPC란 관련 있는 RPC 엔드포인트들을 묶은 그룹이다.
> 어떤 관련이 있는지 개발자 판단이다. 어떠한 문제를 해결하는 데 필요한 엔드포인트들이다.

### service 키워드

---
컴파일러가 생성해야할 서비스라는 의미. rpc로 시작하는 각각의 줄은 서비스의 엔드포인트이다.
